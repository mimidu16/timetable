<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Widget Horaires</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Open+Sans&display=swap');

    body {
      margin: 0;
      padding: 0;
      font-family: 'Open Sans', sans-serif;
      font-size: 16px;
      color: #172042;
    }

    .widget {
      width: 430px;
      height: 360px;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      padding: 20px;
      box-sizing: border-box;
      background: #fff;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    h2 {
      margin: 0 0 15px;
      font-size: 20px;
      text-align: center;
    }

    .hours {
      list-style: none;
      padding: 0;
      margin: 0;
      flex: 1;
    }

    .hours li {
      display: flex;
      justify-content: space-between;
      padding: 6px 0;
      border-bottom: 1px solid #eee;
    }

    .today.open {
      color: #2e8b57; /* Vert quand ouvert */
      font-weight: bold;
    }

    .today.closed {
      color: #c0392b; /* Rouge quand fermé */
      font-weight: bold;
    }

    .status {
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      padding: 10px;
      border-radius: 8px;
    }

    .status.open {
      color: #2e8b57;
    }

    .status.closed {
      color: #c0392b;
    }
  </style>
</head>
<body>
  <div class="widget">
    <h2>Horaires d’ouverture</h2>
    <ul id="hours-list" class="hours">
      <li>Chargement...</li>
    </ul>
    <div id="status" class="status">—</div>
  </div>

  <script>
    const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT_lB-xqc8azKUcUUi6eQm-CvGoQzdxfnzW9hrN9oySai_zo3eTxEjjVYc_NhQ8P8mNTTULnymjN53W/pub?output=csv";

    async function fetchHours() {
      try {
        const response = await fetch(sheetURL);
        const data = await response.text();

        const rows = data.trim().split("\n").map(r => r.split(","));
        const list = document.getElementById("hours-list");
        list.innerHTML = "";

        const today = new Date().toLocaleDateString('fr-FR', { weekday: 'long' }).toLowerCase();
        let openNow = false;
        let todayStatus = "closed";

        rows.forEach(row => {
          const day = row[0].charAt(0).toUpperCase() + row[0].slice(1); // majuscule
          const hours = row[1] || "Fermé";

          const li = document.createElement("li");
          li.innerHTML = `<span>${day}</span><span>${hours}</span>`;

          if (row[0].toLowerCase() === today) {
            li.classList.add("today");

            if (hours.toLowerCase() !== "fermé") {
              const [open, close] = hours.split("-").map(h => h.trim());
              const now = new Date();
              const [oh, om] = open.split(":").map(Number);
              const [ch, cm] = close.split(":").map(Number);

              const openTime = new Date();
              openTime.setHours(oh, om, 0);
              const closeTime = new Date();
              closeTime.setHours(ch, cm, 0);

              if (now >= openTime && now <= closeTime) {
                openNow = true;
                todayStatus = "open";
              } else {
                todayStatus = "closed";
              }
            } else {
              todayStatus = "closed";
            }
            li.classList.add(todayStatus);
          }

          list.appendChild(li);
        });

        const statusDiv = document.getElementById("status");
        if (openNow) {
          statusDiv.textContent = "✅ Actuellement ouvert";
          statusDiv.className = "status open";
        } else {
          statusDiv.textContent = "❌ Actuellement fermé";
          statusDiv.className = "status closed";
        }
      } catch (err) {
        console.error("Erreur de chargement des horaires :", err);
        document.getElementById("hours-list").innerHTML = "<li>Erreur de chargement</li>";
        document.getElementById("status").textContent = "";
      }
    }

    fetchHours();
  </script>
</body>
</html>
